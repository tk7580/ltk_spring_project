<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default_layout}">

<head>
  <title th:text="${work.titleKr} + ' - LoreLoom'"></title>
  <th:block layout:fragment="css">
    <style>
      /* ... (기존 CSS는 이전과 동일) ... */
      .action-buttons .btn.wish-active svg {
        fill: #ffc107; /* 아이콘 내부를 노란색으로 채움 */
        stroke: #e6ac00; /* 테두리도 진한 노란색으로 */
      }
    </style>
  </th:block>
</head>

<th:block layout:fragment="content">
  <main class="main-content">
    <section class="content-section detail-section">
      <div class="detail-container">
        <div class="detail-poster-wrapper">
          <img th:src="${work.thumbnailUrl != null ? work.thumbnailUrl : '/images/placeholder_poster.png'}" alt="작품 포스터"/>
        </div>
        <div class="detail-info">
          <div class="detail-title-wrapper">
            <h1 th:text="${work.titleKr}">작품 제목</h1>
            <p class="title-original" th:text="${work.titleOriginal}">Original Title</p>
          </div>
          <div class="detail-separator"></div>
          <ul class="detail-meta-list">
            <li><strong>타입</strong> <span th:text="${work.type}"></span></li>
            <li><strong>출시일</strong> <span th:text="${work.releaseDate}"></span></li>
            <li th:if="${!work.type.equals('Movie')}">
              <strong>완결여부</strong>
              <span th:text="${work.isCompleted != null and work.isCompleted ? '완결' : '연재 중'}"></span>
            </li>
          </ul>
          <div class="action-buttons-wrapper">
            <div class="action-buttons">
              <a href="javascript:void(0);" class="btn btn-wishlist"
                 th:data-work-id="${work.id}"
                 th:classappend="${isWishlisted} ? 'wish-active'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                <span>찜하기</span>
              </a>
              <a href="#" class="btn btn-rate">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                <span>평점 매기기</span>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="detail-separator"></div>
      <div class="detail-description">
        <p th:text="${work.description}">작품에 대한 상세 설명이 여기에 들어갑니다.</p>
      </div>
    </section>
  </main>
</th:block>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function() {
      const wishlistBtn = document.querySelector(".btn-wishlist");

      if (wishlistBtn) {
        wishlistBtn.addEventListener("click", function(e) {
          e.preventDefault();

          if (![[${currentUser != null}]]) {
            alert("로그인이 필요한 기능입니다.");
            window.location.href = "/member/login";
            return;
          }

          const workId = this.dataset.workId;
          const isWishlisted = this.classList.contains("wish-active");

          const url = `/member/activity/work/${workId}/wishlist`;
          const method = isWishlisted ? 'DELETE' : 'POST';

          fetch(url, {
            method: method
          })
                  .then(response => {
                    if (response.ok) {
                      this.classList.toggle("wish-active");
                    } else {
                      response.text().then(text => alert("요청 처리 중 오류가 발생했습니다: " + text));
                    }
                  })
                  .catch(error => {
                    console.error("Error:", error);
                    alert("요청 중 오류가 발생했습니다.");
                  });
        });
      }
    });
  </script>
</th:block>
</html>